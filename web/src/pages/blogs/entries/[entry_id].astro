---
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';

import type { BlogEntry } from '@/lib/contentful';
import { contentfulClient, renderImageOption } from '@/lib/contentful';
import Layout from '@/layouts/Layout.astro';
import Breadcrumbs from '@/components/Breadcrumbs.astro';

export async function getStaticPaths() {
  const blogEntries = await contentfulClient.getEntries<BlogEntry>({
    content_type: 'blog_entries',
  });

  const pages = blogEntries.items.map(item => ({
    params: {
      /** 記事ID */
      entry_id: item.fields['entry_id']
    },
    props: {
      /** 記事タイトル */
      entryTitle: item.fields['entry_title'],
      /** 記事本文 */
      entryBody: documentToHtmlString(item.fields['entry_body'], renderImageOption),
      /** アイキャッチ画像 */
      eyecatch: item.fields['eyecatch'] as any,
    },
  }));

  return pages;
};

const { entryTitle, entryBody, eyecatch } = Astro.props;
---

<Layout title={entryTitle}>
  <section class="grid grid-flow-row grid-rows-[auto_1fr]">
    <Breadcrumbs currentPageName={entryTitle} paths={[{pageName: 'ブログ記事一覧', relativePath: '/blogs/1'}]} />
    {
      eyecatch&&(
        <img src={eyecatch.fields.file.url} alt={
          eyecatch.fields.desctiption
          ? eyecatch.fields.description
          : eyecatch.fields.title
            ? eyecatch.fields.title
            : "アイキャッチ"
        } class="md:w-1/2 m-auto" />
      )
    }
    <article set:html={entryBody} class="blog_entry" />
  </section>
</Layout>

<style is:global>
  /* ブログ記事 */
  .blog_entry {
    @apply px-2 md:px-8
  }
  /* ブログ記事 - 見出し1 */
  .blog_entry h1 {
    @apply text-5xl font-extrabold mt-2 mb-4
  }
  /* ブログ記事 - 見出し2 */
  .blog_entry h2 {
    @apply text-4xl font-extrabold mt-2 mb-4
  }
  /* ブログ記事 - 見出し3 */
  .blog_entry h3 {
    @apply text-3xl font-extrabold mt-1 mb-2
  }
  /* ブログ記事 - 見出し4 */
  .blog_entry h4 {
    @apply text-2xl font-extrabold
  }
  /* ブログ記事 - 見出し5 */
  .blog_entry h5 {
    @apply text-xl font-extrabold
  }
  /* ブログ記事 - 見出し6 */
  .blog_entry h6 {
    @apply text-lg font-extrabold
  }
  /* ブログ記事 - 順序なしリスト */
  .blog_entry ul {
    @apply list-disc ml-6 my-4
  }
  /* ブログ記事 - 順序ありリスト */
  .blog_entry ol {
    @apply list-decimal ml-6 my-4
  }
  /* ブログ記事 - ブロック */
  .blog_entry blockquote {
    @apply bg-gray-200 px-2 py-1
  }
  /* ブログ記事 - 水平線 */
  .blog_entry hr {
    @apply my-4
  }
  /* ブログ記事 - 表 */
  .blog_entry table {
    @apply table border my-2
  }
  /* ブログ記事 - 画像 */
  .blog_entry img {
    @apply w-2/3 m-auto
  }
  /* ブログ記事 - リンク */
  .blog_entry a {
    @apply link link-hover text-indigo-700
  }
  /* ブログ記事 - リンク(訪問済み) */
  .blog_entry a:visited {
    @apply text-purple-700
  }
</style>